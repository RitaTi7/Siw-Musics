<!DOCTYPE html>
<html>
    <head>
        <title>Brano</title>
		<link rel="stylesheet" href="/css/stile1.css" />
		<link rel="stylesheet" href="/css/stile2.css" />
		<link rel="stylesheet" href="/css/stile3.css"/>
		<link rel="icon" href="piuma.jpg" type="/image/JPG" />
    </head>
	
	<body>
		
 			<header>
				<div class="logo"><img src="/images/piuma.jpg" width="2%"/> SIW Music</div>
				<nav>
					<a th:href="@{/}"><button>Home</button></a>
					<a th:href="@{/brano}"><button>Brani</button></a>
					<a th:href="@{/autore}"><button>Autori</button></a>
					<span th:if="${userDetails}">
						<span th:text="${userDetails.username}"></span>
						<a th:href="@{/logout}"><button>Logout</button></a>
					</span>
					<span th:unless="${userDetails}">
						<a th:href="@{/login}"><button>Login</button></a>
					</span>
				</nav>
 			</header>
		
			<div style="display: flex; flex:1;">
		    	<div class="container-obj" th:if="${brano}">
		        	<h1 th:text="${brano.titolo}">Titolo brano</h1>
					<div class="settings3" sec:authorize="hasAuthority('ADMIN')">
						<a th:href="@{'/admin/formModificaBrano/' + ${brano.id}}"><button type="button">Modifica dati</button></a><br>
						<span><a th:href="@{'/admin/modificaAutoriDiBrano/' + ${brano.id}}"><button type="button">Modifica autori</button></a></span><br>
						<span ><a th:href="@{/admin/aggiornaBrani}"><button type="button">Fine</button></a></span>
					</div>
		        	<p class="importante">Anno di pubblicazione: <span th:text="${brano.anno}">2003</span></p>
					<p class="importante">Genere: <span th:text="${brano.genere}">rock</span></p>
					<p class="importante" th:if="${brano.album}">Album: <span th:text="${brano.album}">2003</span></p>
					<p class="importante">Durata: <span th:text="${brano.durataMinuti}">2003</span> minuti</p>
					<p class="importante">Autori:</p>
					<div class="cliccabile">
				  		<span th:if="${autori.isEmpty()}">Non Ã¨ riscontrabile nessun autore</span>
				  		<span th:unless="${autori.isEmpty()}">
							<ul >
								<li th:each="autore: ${autori}">
									<a th:href="@{'/autore/' + ${autore.id}}" th:text="${autore.nomeArte}">Nome Cognome</a>
								</li>
							</ul>
				  		</span>
					</div>
					<p class="importante" style="margin-top:40px;">Testo:</p>
					<pre class="testo" th:text="${brano.testo}" style="font-size: 1.2em;">
					</pre>
				
				</div>
				<div class="foto">
					<img th:src="@{'/images/' + ${brano.immagine}}" alt="Immagine brano"/>
				</div>

			</div>	
			<div class="recensioni" style="display:flex; flex-direction: column; flex:1;">
						
				<h2>Commenti</h2>
					<span  sec:authorize="hasAuthority('USER')" >
						<a class="settings3" th:href="@{'/user/formNuovoCommento/' + ${brano.id}}"><button type="button">Scrivi</button></a>
					</span><br>
					<input type="checkbox" id="expand-toggle" class="expand-toggle">
            	<div class="recensioni-riquadro">
					<span class="importante" th:if="${commenti.isEmpty()}"> Non sono presenti commenti</span>
                		<ul th:if="${commenti}">
                    		<li th:each="com: ${commenti}">
							<span class="settings3" sec:authorize="hasAuthority('USER')" th:if="${loggedUser != null && com.user.id == loggedUser.id}" style="margin: 20px 0;">
									<a th:href="@{'/eliminaCommento/' + ${com.id} + '/' + ${brano.id}}"><button type="button">Rimuovi</button></a>
								</span>
									

								<span class="settings3" sec:authorize="hasAuthority('ADMIN')" style="margin-top: 20px;">
									<a th:href="@{'/eliminaCommento/' + ${com.id} + '/' + ${brano.id}}"><button type="button">Rimuovi</button></a>
								</span>

								<h4 th:text="${com.titolo + ' (' + com.usernameUtente + ')'}">Titolo</h4>
								
				       			<p th:text="${com.testo}"></p>
							</li>
                		</ul>
            	</div>
				<label for="expand-toggle" class="expand-label" th:if="${!commenti.isEmpty()}"></label>
        	</div>
			
			
			<footer>
	    		&copy; 2025 Siw Music
	  		</footer>
	  	
	</body>
</html>